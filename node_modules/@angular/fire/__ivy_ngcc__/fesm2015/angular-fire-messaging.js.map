{"version":3,"file":"angular-fire-messaging.js","sources":["../../../src/messaging/messaging.ts","../../../src/messaging/messaging.module.ts"],"names":[],"mappings":"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","sourcesContent":["import { Inject, Injectable, NgZone, Optional, PLATFORM_ID } from '@angular/core';\nimport { messaging } from 'firebase/app';\nimport { concat, EMPTY, Observable, of, throwError } from 'rxjs';\nimport { catchError, defaultIfEmpty, map, mergeMap, observeOn, switchMap } from 'rxjs/operators';\nimport {\n  FIREBASE_APP_NAME,\n  FIREBASE_OPTIONS,\n  FirebaseAppConfig,\n  FirebaseOptions,\n  ɵAngularFireSchedulers,\n  ɵfirebaseAppFactory,\n  ɵlazySDKProxy,\n  ɵPromiseProxy\n} from '@angular/fire';\nimport { isPlatformServer } from '@angular/common';\n\nexport interface AngularFireMessaging extends Omit<ɵPromiseProxy<messaging.Messaging>, 'deleteToken' | 'getToken' | 'requestPermission'> {\n}\n\n@Injectable({\n  providedIn: 'any'\n})\nexport class AngularFireMessaging {\n\n  public readonly requestPermission: Observable<void>;\n  public readonly getToken: Observable<string | null>;\n  public readonly tokenChanges: Observable<string | null>;\n  public readonly messages: Observable<{}>;\n  public readonly requestToken: Observable<string | null>;\n  public readonly deleteToken: (token: string) => Observable<boolean>;\n\n  constructor(\n    @Inject(FIREBASE_OPTIONS) options: FirebaseOptions,\n    @Optional() @Inject(FIREBASE_APP_NAME) nameOrConfig: string | FirebaseAppConfig | null | undefined,\n    // tslint:disable-next-line:ban-types\n    @Inject(PLATFORM_ID) platformId: Object,\n    zone: NgZone\n  ) {\n    const schedulers = new ɵAngularFireSchedulers(zone);\n\n    const messaging = of(undefined).pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(() => isPlatformServer(platformId) ? EMPTY : import('firebase/messaging')),\n      map(() => ɵfirebaseAppFactory(options, zone, nameOrConfig)),\n      map(app => app.messaging())\n    );\n\n    if (!isPlatformServer(platformId)) {\n\n      this.requestPermission = messaging.pipe(\n        observeOn(schedulers.outsideAngular),\n        // tslint:disable-next-line\n        switchMap(messaging => messaging.requestPermission())\n      );\n\n    } else {\n\n      this.requestPermission = throwError('Not available on server platform.');\n\n    }\n\n    this.getToken = messaging.pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(messaging => messaging.getToken()),\n      defaultIfEmpty(null)\n    );\n\n    const tokenChanges = messaging.pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(messaging => new Observable(messaging.onTokenRefresh.bind(messaging)).pipe(\n        switchMap(() => messaging.getToken())\n      ))\n    );\n\n    this.tokenChanges = concat(\n      messaging.pipe(\n        observeOn(schedulers.outsideAngular),\n        switchMap(messaging => messaging.getToken())\n      ),\n      tokenChanges\n    );\n\n    this.messages = messaging.pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(messaging => new Observable(messaging.onMessage.bind(messaging)))\n    );\n\n    this.requestToken = of(undefined).pipe(\n      switchMap(() => this.requestPermission),\n      catchError(() => of(null)),\n      mergeMap(() => this.tokenChanges)\n    );\n\n    this.deleteToken = (token: string) => messaging.pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(messaging => messaging.deleteToken(token)),\n      defaultIfEmpty(false)\n    );\n\n    return ɵlazySDKProxy(this, messaging, zone);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { AngularFireMessaging } from './messaging';\n\n@NgModule({\n  providers: [ AngularFireMessaging ]\n})\nexport class AngularFireMessagingModule { }\n"]}