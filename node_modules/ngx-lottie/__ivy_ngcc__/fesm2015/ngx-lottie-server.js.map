{"version":3,"file":"ngx-lottie-server.js","sources":["../../src/server/src/utils.ts","../../src/server/src/internals.ts","../../src/server/src/lottie-server.module.ts"],"names":[],"mappings":"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","sourcesContent":["import { readFile } from 'fs';\n\nimport { AnimationData } from './symbols';\n\nexport function readFileWithAnimationData(path: string) {\n  return new Promise<AnimationData>((resolve, reject) => {\n    readFile(path, (error, data) => {\n      if (error) {\n        return reject(error);\n      }\n\n      resolve(data.toString());\n    });\n  });\n}\n","import { join } from 'path';\nimport { TransferState, makeStateKey } from '@angular/platform-browser';\n\nimport { AnimationFilename, transformAnimationFilenameToKey } from 'ngx-lottie';\n\nimport { readFileWithAnimationData } from './utils';\nimport { LottieServerOptions, PathToAnimation, AnimationData } from './symbols';\n\nfunction readAndTransferAnimationData(\n  transferState: TransferState,\n  animations: AnimationFilename[],\n  pathsToAnimations: PathToAnimation[]\n): Promise<void>[] {\n  const sources: Promise<void>[] = [];\n\n  for (let i = 0, length = animations.length; i < length; i++) {\n    const path = pathsToAnimations[i];\n\n    const source = readFileWithAnimationData(path).then(animationData => {\n      transferAnimationData(transferState, animations[i], animationData);\n    });\n\n    sources.push(source);\n  }\n\n  return sources;\n}\n\nfunction transferAnimationData(\n  state: TransferState,\n  animation: AnimationFilename,\n  animationData: AnimationData\n): void {\n  animation = transformAnimationFilenameToKey(animation);\n  const key = makeStateKey(animation);\n  state.set(key, JSON.parse(animationData));\n}\n\nexport function appInitializerFactory(options: LottieServerOptions, state: TransferState) {\n  const pathsToAnimations = resolveLottiePaths(options);\n  const sources = readAndTransferAnimationData(\n    state,\n    options.preloadAnimations.animations,\n    pathsToAnimations\n  );\n\n  return () => Promise.all(sources);\n}\n\nexport function resolveLottiePaths({ preloadAnimations }: LottieServerOptions): PathToAnimation[] {\n  const { folder, animations } = preloadAnimations;\n  const path = join(process.cwd(), folder);\n\n  return animations.map(animation => join(path, animation));\n}\n","import { NgModule, ModuleWithProviders, InjectionToken, APP_INITIALIZER } from '@angular/core';\nimport { TransferState } from '@angular/platform-browser';\n\nimport { LottieServerOptions } from './symbols';\nimport { appInitializerFactory } from './internals';\n\nexport const LOTTIE_SERVER_OPTIONS = new InjectionToken<LottieServerOptions>('LottieServerOptions');\n\n@NgModule()\nexport class LottieServerModule {\n  static forRoot(options: LottieServerOptions): ModuleWithProviders<LottieServerModule> {\n    return {\n      ngModule: LottieServerModule,\n      providers: [\n        {\n          provide: LOTTIE_SERVER_OPTIONS,\n          useValue: options\n        },\n        {\n          provide: APP_INITIALIZER,\n          useFactory: appInitializerFactory,\n          multi: true,\n          deps: [LOTTIE_SERVER_OPTIONS, TransferState]\n        }\n      ]\n    };\n  }\n}\n"]}