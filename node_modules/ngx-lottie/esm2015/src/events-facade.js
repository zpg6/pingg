/**
 * @fileoverview added by tsickle
 * Generated from: src/events-facade.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, NgZone, Inject, EventEmitter, PLATFORM_ID } from '@angular/core';
import { isPlatformServer } from '@angular/common';
/**
 * Returns only those `EventEmitter` instances that has attached observers
 * @param {?} instance
 * @param {?} eventsMap
 * @return {?}
 */
function getObservedEventEmitters(instance, eventsMap) {
    return (Object.keys(instance)
        // `Object.entries` is not supported in IE11.
        .map((/**
     * @param {?} key
     * @return {?}
     */
    key => [key, instance[key]]))
        .filter((/**
     * @param {?} __0
     * @return {?}
     */
    ([key, property]) => property instanceof EventEmitter &&
        property.observers.length > 0 &&
        eventsMap.hasOwnProperty(key)))
        .map((/**
     * @param {?} __0
     * @return {?}
     */
    ([key, eventEmitter]) => ({
        eventEmitter,
        name: eventsMap[key],
    }))));
}
export class LottieEventsFacade {
    /**
     * @param {?} ngZone
     * @param {?} platformId
     */
    constructor(ngZone, platformId) {
        this.ngZone = ngZone;
        this.platformId = platformId;
        /**
         * @see https://github.com/airbnb/lottie-web#events
         */
        this.eventsMap = {
            complete: 'complete',
            loopComplete: 'loopComplete',
            enterFrame: 'enterFrame',
            segmentStart: 'segmentStart',
            configReady: 'config_ready',
            dataReady: 'data_ready',
            domLoaded: 'DOMLoaded',
            destroy: 'destroy',
            error: 'error',
        };
        this.animationItem = null;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroyAnimation();
    }
    /**
     * @param {?} instance
     * @param {?} animationItem
     * @return {?}
     */
    addEventListeners(instance, animationItem) {
        this.animationItem = animationItem;
        // `AnimationItem` triggers different events every ms, we have to listen
        // them outside Angular's context, thus it won't affect performance
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => this.addEventListenersToObservedEventEmitters(instance)));
    }
    /**
     * @return {?}
     */
    destroyAnimation() {
        // The `ng-lottie` component or the `lottie` directive can be destroyed
        // before the `animationItem` is set, thus it will fail with
        // `Cannot read property 'destroy' of null`.
        // Potentially it can happen if the directive gets destroyed before change
        // detection is run.
        if (isPlatformServer(this.platformId) || this.animationItem === null) {
            return;
        }
        // `destroy()` will remove all events listeners
        this.animationItem.destroy();
        this.animationItem = null;
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    addEventListenersToObservedEventEmitters(instance) {
        /** @type {?} */
        const observedEmitters = getObservedEventEmitters(instance, this.eventsMap);
        for (const { name, eventEmitter } of observedEmitters) {
            (/** @type {?} */ (this.animationItem)).addEventListener(name, (/**
             * @param {?} event
             * @return {?}
             */
            (event) => {
                eventEmitter.emit(event);
            }));
        }
    }
}
LottieEventsFacade.decorators = [
    { type: Injectable }
];
/** @nocollapse */
LottieEventsFacade.ctorParameters = () => [
    { type: NgZone },
    { type: String, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
if (false) {
    /**
     * @see https://github.com/airbnb/lottie-web#events
     * @type {?}
     * @private
     */
    LottieEventsFacade.prototype.eventsMap;
    /**
     * @type {?}
     * @private
     */
    LottieEventsFacade.prototype.animationItem;
    /**
     * @type {?}
     * @private
     */
    LottieEventsFacade.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    LottieEventsFacade.prototype.platformId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRzLWZhY2FkZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zcmMvZXZlbnRzLWZhY2FkZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBYSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7O0FBUW5ELFNBQVMsd0JBQXdCLENBQUMsUUFBdUIsRUFBRSxTQUFvQjtJQUM3RSxPQUFPLENBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDbkIsNkNBQTZDO1NBQzVDLEdBQUc7Ozs7SUFBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFDO1NBQ2hDLE1BQU07Ozs7SUFDTCxDQUFDLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FDbEIsUUFBUSxZQUFZLFlBQVk7UUFDaEMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUM3QixTQUFTLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxFQUNoQztTQUNBLEdBQUc7Ozs7SUFBQyxDQUFDLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzdCLFlBQVk7UUFDWixJQUFJLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQztLQUNyQixDQUFDLEVBQUMsQ0FDTixDQUFDO0FBQ0osQ0FBQztBQUdELE1BQU0sT0FBTyxrQkFBa0I7Ozs7O0lBa0I3QixZQUFvQixNQUFjLEVBQStCLFVBQWtCO1FBQS9ELFdBQU0sR0FBTixNQUFNLENBQVE7UUFBK0IsZUFBVSxHQUFWLFVBQVUsQ0FBUTs7OztRQWQzRSxjQUFTLEdBQWM7WUFDN0IsUUFBUSxFQUFFLFVBQVU7WUFDcEIsWUFBWSxFQUFFLGNBQWM7WUFDNUIsVUFBVSxFQUFFLFlBQVk7WUFDeEIsWUFBWSxFQUFFLGNBQWM7WUFDNUIsV0FBVyxFQUFFLGNBQWM7WUFDM0IsU0FBUyxFQUFFLFlBQVk7WUFDdkIsU0FBUyxFQUFFLFdBQVc7WUFDdEIsT0FBTyxFQUFFLFNBQVM7WUFDbEIsS0FBSyxFQUFFLE9BQU87U0FDZixDQUFDO1FBRU0sa0JBQWEsR0FBeUIsSUFBSSxDQUFDO0lBRW1DLENBQUM7Ozs7SUFFdkYsV0FBVztRQUNULElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzFCLENBQUM7Ozs7OztJQUVELGlCQUFpQixDQUFDLFFBQXVCLEVBQUUsYUFBNEI7UUFDckUsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsd0VBQXdFO1FBQ3hFLG1FQUFtRTtRQUNuRSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQjs7O1FBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHdDQUF3QyxDQUFDLFFBQVEsQ0FBQyxFQUFDLENBQUM7SUFDL0YsQ0FBQzs7OztJQUVELGdCQUFnQjtRQUNkLHVFQUF1RTtRQUN2RSw0REFBNEQ7UUFDNUQsNENBQTRDO1FBQzVDLDBFQUEwRTtRQUMxRSxvQkFBb0I7UUFDcEIsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxJQUFJLEVBQUU7WUFDcEUsT0FBTztTQUNSO1FBRUQsK0NBQStDO1FBQy9DLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFDNUIsQ0FBQzs7Ozs7O0lBRU8sd0NBQXdDLENBQUMsUUFBdUI7O2NBQ2hFLGdCQUFnQixHQUFHLHdCQUF3QixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBRTNFLEtBQUssTUFBTSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsSUFBSSxnQkFBZ0IsRUFBRTtZQUNyRCxtQkFBQSxJQUFJLENBQUMsYUFBYSxFQUFDLENBQUMsZ0JBQWdCLENBQUMsSUFBSTs7OztZQUFFLENBQUMsS0FBa0IsRUFBRSxFQUFFO2dCQUNoRSxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNCLENBQUMsRUFBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzs7WUF2REYsVUFBVTs7OztZQTNCcUIsTUFBTTt5Q0E4Q0MsTUFBTSxTQUFDLFdBQVc7Ozs7Ozs7O0lBZHZELHVDQVVFOzs7OztJQUVGLDJDQUFtRDs7Ozs7SUFFdkMsb0NBQXNCOzs7OztJQUFFLHdDQUErQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9uRGVzdHJveSwgSW5qZWN0YWJsZSwgTmdab25lLCBJbmplY3QsIEV2ZW50RW1pdHRlciwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1TZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5pbXBvcnQgeyBCYXNlRGlyZWN0aXZlIH0gZnJvbSAnLi9iYXNlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBFdmVudHNNYXAsIExvdHRpZUV2ZW50LCBBbmltYXRpb25JdGVtIH0gZnJvbSAnLi9zeW1ib2xzJztcblxuLyoqXG4gKiBSZXR1cm5zIG9ubHkgdGhvc2UgYEV2ZW50RW1pdHRlcmAgaW5zdGFuY2VzIHRoYXQgaGFzIGF0dGFjaGVkIG9ic2VydmVyc1xuICovXG5mdW5jdGlvbiBnZXRPYnNlcnZlZEV2ZW50RW1pdHRlcnMoaW5zdGFuY2U6IEJhc2VEaXJlY3RpdmUsIGV2ZW50c01hcDogRXZlbnRzTWFwKSB7XG4gIHJldHVybiAoXG4gICAgT2JqZWN0LmtleXMoaW5zdGFuY2UpXG4gICAgICAvLyBgT2JqZWN0LmVudHJpZXNgIGlzIG5vdCBzdXBwb3J0ZWQgaW4gSUUxMS5cbiAgICAgIC5tYXAoa2V5ID0+IFtrZXksIGluc3RhbmNlW2tleV1dKVxuICAgICAgLmZpbHRlcihcbiAgICAgICAgKFtrZXksIHByb3BlcnR5XSkgPT5cbiAgICAgICAgICBwcm9wZXJ0eSBpbnN0YW5jZW9mIEV2ZW50RW1pdHRlciAmJlxuICAgICAgICAgIHByb3BlcnR5Lm9ic2VydmVycy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgZXZlbnRzTWFwLmhhc093blByb3BlcnR5KGtleSksXG4gICAgICApXG4gICAgICAubWFwKChba2V5LCBldmVudEVtaXR0ZXJdKSA9PiAoe1xuICAgICAgICBldmVudEVtaXR0ZXIsXG4gICAgICAgIG5hbWU6IGV2ZW50c01hcFtrZXldLFxuICAgICAgfSkpXG4gICk7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBMb3R0aWVFdmVudHNGYWNhZGUgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vYWlyYm5iL2xvdHRpZS13ZWIjZXZlbnRzXG4gICAqL1xuICBwcml2YXRlIGV2ZW50c01hcDogRXZlbnRzTWFwID0ge1xuICAgIGNvbXBsZXRlOiAnY29tcGxldGUnLFxuICAgIGxvb3BDb21wbGV0ZTogJ2xvb3BDb21wbGV0ZScsXG4gICAgZW50ZXJGcmFtZTogJ2VudGVyRnJhbWUnLFxuICAgIHNlZ21lbnRTdGFydDogJ3NlZ21lbnRTdGFydCcsXG4gICAgY29uZmlnUmVhZHk6ICdjb25maWdfcmVhZHknLFxuICAgIGRhdGFSZWFkeTogJ2RhdGFfcmVhZHknLFxuICAgIGRvbUxvYWRlZDogJ0RPTUxvYWRlZCcsXG4gICAgZGVzdHJveTogJ2Rlc3Ryb3knLFxuICAgIGVycm9yOiAnZXJyb3InLFxuICB9O1xuXG4gIHByaXZhdGUgYW5pbWF0aW9uSXRlbTogQW5pbWF0aW9uSXRlbSB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogc3RyaW5nKSB7fVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveUFuaW1hdGlvbigpO1xuICB9XG5cbiAgYWRkRXZlbnRMaXN0ZW5lcnMoaW5zdGFuY2U6IEJhc2VEaXJlY3RpdmUsIGFuaW1hdGlvbkl0ZW06IEFuaW1hdGlvbkl0ZW0pOiB2b2lkIHtcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0gPSBhbmltYXRpb25JdGVtO1xuICAgIC8vIGBBbmltYXRpb25JdGVtYCB0cmlnZ2VycyBkaWZmZXJlbnQgZXZlbnRzIGV2ZXJ5IG1zLCB3ZSBoYXZlIHRvIGxpc3RlblxuICAgIC8vIHRoZW0gb3V0c2lkZSBBbmd1bGFyJ3MgY29udGV4dCwgdGh1cyBpdCB3b24ndCBhZmZlY3QgcGVyZm9ybWFuY2VcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzVG9PYnNlcnZlZEV2ZW50RW1pdHRlcnMoaW5zdGFuY2UpKTtcbiAgfVxuXG4gIGRlc3Ryb3lBbmltYXRpb24oKTogdm9pZCB7XG4gICAgLy8gVGhlIGBuZy1sb3R0aWVgIGNvbXBvbmVudCBvciB0aGUgYGxvdHRpZWAgZGlyZWN0aXZlIGNhbiBiZSBkZXN0cm95ZWRcbiAgICAvLyBiZWZvcmUgdGhlIGBhbmltYXRpb25JdGVtYCBpcyBzZXQsIHRodXMgaXQgd2lsbCBmYWlsIHdpdGhcbiAgICAvLyBgQ2Fubm90IHJlYWQgcHJvcGVydHkgJ2Rlc3Ryb3knIG9mIG51bGxgLlxuICAgIC8vIFBvdGVudGlhbGx5IGl0IGNhbiBoYXBwZW4gaWYgdGhlIGRpcmVjdGl2ZSBnZXRzIGRlc3Ryb3llZCBiZWZvcmUgY2hhbmdlXG4gICAgLy8gZGV0ZWN0aW9uIGlzIHJ1bi5cbiAgICBpZiAoaXNQbGF0Zm9ybVNlcnZlcih0aGlzLnBsYXRmb3JtSWQpIHx8IHRoaXMuYW5pbWF0aW9uSXRlbSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGBkZXN0cm95KClgIHdpbGwgcmVtb3ZlIGFsbCBldmVudHMgbGlzdGVuZXJzXG4gICAgdGhpcy5hbmltYXRpb25JdGVtLmRlc3Ryb3koKTtcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0gPSBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRFdmVudExpc3RlbmVyc1RvT2JzZXJ2ZWRFdmVudEVtaXR0ZXJzKGluc3RhbmNlOiBCYXNlRGlyZWN0aXZlKTogdm9pZCB7XG4gICAgY29uc3Qgb2JzZXJ2ZWRFbWl0dGVycyA9IGdldE9ic2VydmVkRXZlbnRFbWl0dGVycyhpbnN0YW5jZSwgdGhpcy5ldmVudHNNYXApO1xuXG4gICAgZm9yIChjb25zdCB7IG5hbWUsIGV2ZW50RW1pdHRlciB9IG9mIG9ic2VydmVkRW1pdHRlcnMpIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uSXRlbSEuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCAoZXZlbnQ6IExvdHRpZUV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50RW1pdHRlci5lbWl0KGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19