{"version":3,"sources":["../../src/server/src/internals.ts","../../src/server/src/utils.ts","../../src/server/src/lottie-server.module.ts"],"names":["readAndTransferAnimationData","transferState","animations","pathsToAnimations","sources","i","length","source","path","Promise","resolve","reject","readFile","error","data","toString","readFileWithAnimationData","then","animationData","state","animation","transformAnimationFilenameToKey","key","makeStateKey","set","JSON","parse","transferAnimationData","push","appInitializerFactory","options","preloadAnimations","folder","join","process","cwd","map","all","LOTTIE_SERVER_OPTIONS","InjectionToken","LottieServerModule","forRoot","ngModule","providers","provide","useValue","APP_INITIALIZER","useFactory","multi","deps","TransferState","NgModule"],"mappings":"keAQA,SAASA,EACPC,EACAC,EACAC,GAIA,QAFMC,EAA2B,cAExBC,EAAOC,OAGRC,WCdgCC,GACxC,OAAO,IAAIC,SAAO,SAAiBC,EAASC,GAC1CC,EAAAA,SAASJ,GAAI,SAAGK,EAAOC,GACrB,GAAID,EACF,OAAOF,EAAOE,GAGhBH,EAAQI,EAAKC,kBDOAC,CAFFb,EAAkBE,IAEgBY,MAAI,SAACC,IAUxD,SACEC,EACAC,EACAF,GAEAE,EAAYC,EAAAA,gCAAgCD,OACtCE,EAAMC,EAAAA,aAAaH,GACzBD,EAAMK,IAAIF,EAAKG,KAAKC,MAAMR,IAhBtBS,CAAsB1B,EAAeC,EAAWG,GAAIa,MAGtDd,EAAQwB,KAAKrB,IAPNF,EAAI,EAAGC,EAASJ,EAAWI,OAAQD,EAAIC,EAAQD,MAA/CA,GAUT,OAAOD,WAaOyB,EAAsBC,EAA8BX,OAW/BY,EAC3BC,EAAQ9B,EACVM,EAZAL,GAU6B4B,EAVUD,EAUOC,kBAC5CC,EAAuBD,EAAiBC,OAAhC9B,EAAe6B,EAAiB7B,WAC1CM,EAAOyB,EAAAA,KAAKC,QAAQC,MAAOH,GAE1B9B,EAAWkC,KAAG,SAAChB,GAAa,OAAAa,EAAAA,KAAKzB,EAAMY,OAbxChB,EAAUJ,EACdmB,EACAW,EAAQC,kBAAkB7B,WAC1BC,GAGF,OAAA,WAAa,OAAAM,QAAQ4B,IAAIjC,QExCdkC,EAAwB,IAAIC,EAAAA,eAAoC,oCAG7E,SAAAC,YACSA,EAAAC,QAAP,SAAeX,GACb,MAAO,CACLY,SAAUF,EACVG,UAAW,CACT,CACEC,QAASN,EACTO,SAAUf,GAEZ,CACEc,QAASE,EAAAA,gBACTC,WAAYlB,EACZmB,OAAO,EACPC,KAAM,CAACX,EAAuBY,EAAAA,4CAdvCC,EAAAA","sourcesContent":["import { join } from 'path';\nimport { TransferState, makeStateKey } from '@angular/platform-browser';\n\nimport { AnimationFilename, transformAnimationFilenameToKey } from 'ngx-lottie';\n\nimport { readFileWithAnimationData } from './utils';\nimport { LottieServerOptions, PathToAnimation, AnimationData } from './symbols';\n\nfunction readAndTransferAnimationData(\n  transferState: TransferState,\n  animations: AnimationFilename[],\n  pathsToAnimations: PathToAnimation[]\n): Promise<void>[] {\n  const sources: Promise<void>[] = [];\n\n  for (let i = 0, length = animations.length; i < length; i++) {\n    const path = pathsToAnimations[i];\n\n    const source = readFileWithAnimationData(path).then(animationData => {\n      transferAnimationData(transferState, animations[i], animationData);\n    });\n\n    sources.push(source);\n  }\n\n  return sources;\n}\n\nfunction transferAnimationData(\n  state: TransferState,\n  animation: AnimationFilename,\n  animationData: AnimationData\n): void {\n  animation = transformAnimationFilenameToKey(animation);\n  const key = makeStateKey(animation);\n  state.set(key, JSON.parse(animationData));\n}\n\nexport function appInitializerFactory(options: LottieServerOptions, state: TransferState) {\n  const pathsToAnimations = resolveLottiePaths(options);\n  const sources = readAndTransferAnimationData(\n    state,\n    options.preloadAnimations.animations,\n    pathsToAnimations\n  );\n\n  return () => Promise.all(sources);\n}\n\nexport function resolveLottiePaths({ preloadAnimations }: LottieServerOptions): PathToAnimation[] {\n  const { folder, animations } = preloadAnimations;\n  const path = join(process.cwd(), folder);\n\n  return animations.map(animation => join(path, animation));\n}\n","import { readFile } from 'fs';\n\nimport { AnimationData } from './symbols';\n\nexport function readFileWithAnimationData(path: string) {\n  return new Promise<AnimationData>((resolve, reject) => {\n    readFile(path, (error, data) => {\n      if (error) {\n        return reject(error);\n      }\n\n      resolve(data.toString());\n    });\n  });\n}\n","import { NgModule, ModuleWithProviders, InjectionToken, APP_INITIALIZER } from '@angular/core';\nimport { TransferState } from '@angular/platform-browser';\n\nimport { LottieServerOptions } from './symbols';\nimport { appInitializerFactory } from './internals';\n\nexport const LOTTIE_SERVER_OPTIONS = new InjectionToken<LottieServerOptions>('LottieServerOptions');\n\n@NgModule()\nexport class LottieServerModule {\n  static forRoot(options: LottieServerOptions): ModuleWithProviders<LottieServerModule> {\n    return {\n      ngModule: LottieServerModule,\n      providers: [\n        {\n          provide: LOTTIE_SERVER_OPTIONS,\n          useValue: options\n        },\n        {\n          provide: APP_INITIALIZER,\n          useFactory: appInitializerFactory,\n          multi: true,\n          deps: [LOTTIE_SERVER_OPTIONS, TransferState]\n        }\n      ]\n    };\n  }\n}\n"]}